{% extends "SEPlatformBundle::layout.html.twig" %}

{% block title %}
    Offres proposées - {{ parent() }}
{% endblock %}

{% block layout_header2 %}
<div class="row">
  <div id="header" class="col-md-12">
    <h3 class="cat-title">Offres proposées</h3>
        {{ include('@SEPlatform/Auction/listUserSendFilter.html.twig') }}
  </div>
</div>
{% endblock %}
{% block layout_body %}
  <div class="row">
       <div id="content" class="col-md-12">
         <h4 class="cat-title">{{ titleResult }}</h4>
            <table class="table" id="tblGrid">
                <tbody>
                {% for auction in listAuctionUser %}
                <tr>
                    <td>
                        <h5>
                            <a class='se-tbl-link' href="{{ path('se_platform_advert_view', {'slug': auction.advert.slug,'id': auction.advert.id}) }}">{{ auction.advert.title }}</a>

                            <h5 class="hidden-xs hidden-sm">
                              Par
                              <a class='se-tbl-link' href="{{ path('se_platform_user_view', {'userId': auction.advert.user.id}) }}" class="cat-link" >
                                  {{ auction.advert.user }}
                              </a>

                            </h5>
                        </h5>
                    </td>
                    <td>
                      <h5 class="hidden-xs hidden-sm">
                          le {{ auction.dateCreation|date('d/m/Y') }}
                          à
                          {{ auction.dateCreation|date('H:i:s') }}
                        </h5>
                          </td>
                    <td>
                      <h5 class="visible-xs visible-sm">
                        <a class="cat-link"
                            data-toggle="modal"
                            role="button"
                            data-toggle="modal"
                            data-target="#modalAuctionShow_{{auction.advert.id}}"
                            >
                              {{ render(controller('SEPlatformBundle:Auction:getNbAuction', { 'advertId': auction.advert.id })) }}
                            </a>
                      </h5>
                      <h5 class="visible-xs visible-sm">
                        {% if auction.state == 1 %}
                            <span class="label label-warning">{{ auction.value|number_format(0, ' ', ' ') }} €  / {{auction.advert.BudgetType.slug}}<span>
                        {% elseif auction.state == 2 %}
                            <span class="label label-success">{{ auction.value|number_format(0, ' ', ' ') }} €  / {{auction.advert.BudgetType.slug}}<span>
                        {% elseif auction.state == 3 %}
                            <span class="label label-default">{{ auction.value|number_format(0, ' ', ' ') }} €  / {{auction.advert.BudgetType.slug}}<span>
                        {% endif %}
                      </h5>
                        <h5>
                        {% if auction.state == 1 %}
                            <span class="label label-warning">En cours</span>
                        {% elseif auction.state == 2 %}
                            <span class="label label-success">Acceptée</span>
                            <div class="label label-success"
                                  data-toggle="tooltip"
                                        data-placement="bottom" title="La demande n'est plus visible sur le site">
                             <i class="glyphicon glyphicon-info-sign"> </i>
                            </div>
                        {% elseif auction.state == 3 %}
                            <span class="label label-default">Déclinée</span>
                            <div class="label label-default"
                                  data-toggle="tooltip"
                                        data-placement="bottom" title="La demande n'est plus visible sur le site">
                             <i class="glyphicon glyphicon-info-sign"> </i>
                            </div>
                        {% endif %}
                        </h5>
                        <h5 class="visible-xs visible-sm">
                          <a
                            class='{% if auction.state != 1 %} btn btn-danger not-active {% else %} btn btn-danger  {% endif %}'
                                data-toggle="modal"
                                role="button"
                                data-toggle="modal"
                                data-target="#modalAdvertCancel_{{auction.id}}"
                                >Annuler
                            </a>
                        </h5>
                    </td>
                    <td>
                        <h5 class="hidden-xs hidden-sm">
                          <a class="cat-link"
                              data-toggle="modal"
                              role="button"
                              data-toggle="modal"
                              data-target="#modalAuctionShow_{{auction.advert.id}}"
                              >
                                {{ render(controller('SEPlatformBundle:Auction:getNbAuction', { 'advertId': auction.advert.id })) }}
                        </h5>
                      </td>
                      <td>
                        <h5 class="hidden-xs hidden-sm">
                        {% if auction.state == 1 %}
                            <span class="label label-warning">{{ auction.value|number_format(0, ' ', ' ') }} €  / {{auction.advert.BudgetType.slug}}<span>
                        {% elseif auction.state == 2 %}
                            <span class="label label-success">{{ auction.value|number_format(0, ' ', ' ') }} €  / {{auction.advert.BudgetType.slug}}<span>
                        {% elseif auction.state == 3 %}
                            <span class="label label-default">{{ auction.value|number_format(0, ' ', ' ') }} €  / {{auction.advert.BudgetType.slug}}<span>
                        {% endif %}
                        </h5>
                      </td>
                    <td>
                      <h5 class="hidden-xs hidden-sm">
                          <a
                            class='{% if auction.state != 1 %} btn btn-danger not-active {% else %} btn btn-danger  {% endif %}'
                                data-toggle="modal"
                                role="button"
                                data-toggle="modal"
                                data-target="#modalAdvertCancel_{{auction.id}}"
                                >Annuler
                            </a>
                          </h5>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
       </div>
   </div>

   <div class="row">
       <div class="col-md-12 text-center">
           <ul class="pagination">
               {% if nbPages > 1 %}
                   {% for p in range(1, nbPages) %}
                       <li{% if p == page %} class="active"{% endif %}>
                           <a href="{{ path('se_platform_auction_user_send', {'page': p}) }}">{{ p }}</a>
                       </li>
                   {% endfor %}
               {% endif %}
           </ul>
       </div>
   </div>
{% for auction in listAuctionUser %}
<div class="modal fade"
     id="modalAdvertCancel_{{auction.id}}"
     tabindex="-1"
     role="dialog"
     aria-labelledby="modalAdvertCancelLabel_{{auction.id}}">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Annuler l'offre</h4>
          </div>
          <div class="modal-body text-center">
           <p class="pad-msg">Etes-vous certain de vouloir annuler l'offre de <strong>{{ auction.value|number_format(0, ' ', ' ') }} € </strong> pour <strong>{{ auction.advert.title }} </strong> ?</p>
           <button type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close">Non</button>
           <a href="{{ path('se_platform_auction_cancel', {'id': auction.id}) }}" class="btn btn-success">Annuler l'offre</a>
          </div>
        </div>
      </div>
</div>

   <div class="modal fade"
        id="modalAuctionShow_{{auction.advert.id}}"
        tabindex="-1"
        role="dialog"
        aria-labelledby="modalAuctionShowLabel_{{auction.advert.id}}">
           <div class="modal-dialog" role="document">
           <div class="modal-content">
             <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
               <h4 class="modal-title" id="myModalLabel_{{auction.advert.id}}">Historique des offres</h4>
             </div>
             <div class="modal-body">
                  {{ render(controller('SEPlatformBundle:Auction:list', { 'advertId': auction.advert.id })) }}
             </div>
           </div>
         </div>
   </div>
{% endfor %}

{% endblock %}
