{% extends "SEPlatformBundle::layout.html.twig" %}

{% block title %}
    Mes Annonces - {{ parent() }}
{% endblock %}

{% block layout_header2 %}
  <div class="row">
    <div id="header" class="col-md-12">
      <h3 class="cat-title">Mes annonces</h3>
        {{ include('@SEPlatform/Advert/listUserFilter.html.twig') }}
    </div>
  </div>
{% endblock %}
{% block layout_body %}
<div class="row">
  <div class="col-md-2"></div>
  <div class="col-md-8">
      {% for flash_message in app.session.flashBag.get('addSuccess') %}
          <div class="alert alert-success text-center" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              {{ flash_message }}
          </div>
      {% endfor %}
      {% for flash_message in app.session.flashBag.get('error') %}
          <div class="alert alert-danger text-center" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              {{ flash_message }}
          </div>
      {% endfor %}
  </div>
  <div class="col-md-2"></div>
</div>
  <div class="row">
       <div id="content" class="col-md-12">
         <h4 class="cat-title">{{ titleResult }}</h4>
            <table class="table" id="tblGrid">
                <tbody>
                {% for advert in listAdvertUser %}
                    <tr>
                        <td>
                            <h5>
                                <a class='se-tbl-link' href="{{ path('se_platform_advert_view', {'slug': advert.slug,'id': advert.id}) }}">{{ advert.title }}</a>
                                <h5 class="hidden-xs hidden-sm">
                                  {{ advert.category.labelNormal }}
                                </h5>
                                <h5 class="hidden-xs hidden-sm">
                                  {{ advert.dateCreation|date('d/m/Y') }}
                                  à
                                  {{ advert.dateCreation|date('H:i:s') }}
                                </h5>
                            </h5>
                        </td>
                        <td class='text-center td_center'>
                            <h5>
                            {% if advert.isPublished == 1 %}
                                <span class="label label-primary">En cours</span>
                            {% elseif advert.isPublished == 0 and advert.auctionState == 0 %}
                                <span class="label label-warning">Validation en cours</span>
                            {% elseif advert.isPublished == 0 and advert.auctionState == 1 %}
                                <span class="label label-danger">Terminée</span>
                                <div class="label label-danger"
                                      data-toggle="tooltip"
                                            data-placement="bottom" title="La demande n'est plus visible sur le site">
                                 <i class="glyphicon glyphicon-info-sign"> </i>
                                </div>
                            {% endif %}
                            </h5>
                            <h5>
                              <a class="cat-link visible-xs visible-sm"
                                  data-toggle="modal"
                                  role="button"
                                  data-toggle="modal"
                                  data-target="#modalAuctionShow_{{advert.id}}"
                                  >
                                    {{ render(controller('SEPlatformBundle:Auction:getNbAuction', { 'advertId': advert.id })) }}
                            </h5>
                        </td>
                        <td class='text-center'>
                          <h5>
                            <a class="cat-link hidden-xs hidden-sm"
                                data-toggle="modal"
                                role="button"
                                data-toggle="modal"
                                data-target="#modalAuctionShow_{{advert.id}}"
                                >
                                  {{ render(controller('SEPlatformBundle:Auction:getNbAuction', { 'advertId': advert.id })) }}
                          </h5>
                        </td>
                         <td class='text-center'>
                            <h5>
                              <a href="{{ path('se_platform_advert_edit', {'slug': advert.slug,'id': advert.id}) }}"
                                type="button"
                                class='{% if advert.auctionState != 0 %} btn btn-success not-active {% else %} btn btn-success  {% endif %}'
                                title="Modifier la demande">
                                <i class='glyphicon glyphicon-edit'></i>
                              </a>

                              <a
                                class='{% if advert.auctionState != 0 %} btn btn-danger not-active {% else %} btn btn-danger  {% endif %}'
                                    data-toggle="modal"
                                    role="button"
                                    data-toggle="modal"
                                    data-target="#modalAdvertDelete_{{advert.id}}"
                                    ><i class='glyphicon glyphicon-remove'></i>
                                </a>

                            </h5>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
       </div>
   </div>


<div class="row">
    <div class="col-md-12 text-center">
        <ul class="pagination">
            {% if nbPages > 1 %}
                {% for p in range(1, nbPages) %}
                    <li{% if p == page %} class="active"{% endif %}>
                        <a href="{{ path('se_platform_advert_user_list', {'page': p}) }}">{{ p }}</a>
                    </li>
                {% endfor %}
            {% endif %}
        </ul>
    </div>
</div>


{% for advert in listAdvertUser %}
 <div class="modal fade"
      id="modalAdvertDelete_{{advert.id}}"
      tabindex="-1"
      role="dialog"
      aria-labelledby="modalAdvertDeleteLabel_{{advert.id}}">
         <div class="modal-dialog" role="document">
         <div class="modal-content">
           <div class="modal-header">
             <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
             <h4 class="modal-title" id="myModalLabel">Supprimer une annonce</h4>
           </div>
           <div class="modal-body text-center">
            <p class="pad-msg">Etes-vous certain de vouloir supprimer la demande <strong>{{ advert.title }} </strong> ?</p>
            <button type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close">Non</button>
            <a href="{{ path('se_platform_advert_delete', {'slug':advert.slug,  'id': advert.id}) }}" class="btn btn-success">Supprimer</a>
           </div>
         </div>
       </div>
 </div>


    <div class="modal fade"
         id="modalAuctionShow_{{advert.id}}"
         tabindex="-1"
         role="dialog"
         aria-labelledby="modalAuctionShowLabel_{{advert.id}}">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel_{{advert.id}}">Historique des offres</h4>
              </div>
              <div class="modal-body">
                   {{ render(controller('SEPlatformBundle:Auction:list', { 'advertId': advert.id })) }}
              </div>
            </div>
          </div>
    </div>

{% endfor %}
{% endblock %}
