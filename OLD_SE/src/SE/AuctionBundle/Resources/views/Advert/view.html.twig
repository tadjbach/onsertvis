{# Afficher une demande - Action #}

{% extends "SELayoutBundle::layout.html.twig" %}

    {% block title %}
        {{ advert.title }} - {{ parent() }}
    {% endblock %}

    {% block se_layout_body %}

    
    <div class="well slogan-well">
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12">
                </div>
            </div>
        </div>
    </div>
    <div class="well se-well">
        <div class="index-container" >
            <div class="row">
                 <div id="content" class="col-md-12">
                    <div class="col-md-6">
                    <h4 class="cat-title">{{ advert.title }}</h4>
                    <i>Mise en ligne le {{ advert.dateCreation|date('d/m/Y') }} à {{ advert.dateCreation|date('H:m') }}</i>
                        Par {{ advert.user }}
                        {{ include('@SEAuction/Advert/itemTuile.html.twig') }}
                    </div>
                    <div class="col-md-6">
                        <h4 class="cat-title">Vous êtes intéressé par cette demande?</h4>
                        {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                            {% if app.user != advert.user%}
                                <div class="row">
                                    <div class="col-md-8">
                                        <form id="form_auction_add" action="" method="get">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-addon">€ </span>
                                                    <input type="text" 
                                                           name="auction_value" 
                                                           required="required" 
                                                           maxlength="50" 
                                                           placeholder="Proposez un prix (en euro)" 
                                                           class="form-control">    
                                                </div>
                                            </div>
                                            <div class="form-group text-right">
                                                     <input 
                                                    class="btn se-btn-action btn"
                                                    type="submit" value="Enchérir"  />
                                            </div>
                                        </form>
                                        
                                        <form name="se_auctionbundle_message" action="" method="get">
                                            <div id="se_auctionbundle_message">
                                                <div class="form-group">
                                                    <textarea id="message_content" 
                                                              name="message_content" 
                                                              required="required" 
                                                              maxlength="1000" 
                                                              placeholder="Ecrivez votre message ici (1000 caratères maximum)" 
                                                              class="form-control" ></textarea>
                                                </div>
                                                <div class="form-group text-right">
                                                    <input type="submit" 
                                                            
                                                            class="btn se-btn-action btn" value="Envoyer"/>
                                                        
                                                    </input>
                                                </div>
                                            </div>
                                        </form>
                                       
                                     </div>
                                    <div class="col-md-8">
                                     {% if app.session.started %}
                                        {% for flashMessage in app.session.flashbag.get('notice') %}
                                            <div class="alert alert-{{ flashMessage.alert }} alert-dismissible" role="alert">
                                                <button type="button" class="close" data-dismiss="alert">
                                                    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                                                </button>
                                                <strong>{{ flashMessage.title }}</strong> {{ flashMessage.message }}
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                    </div>
                                </div>
                            {% else %} 
                                <div class="row" >
                                <div class="col-md-12" >
                                    {% if advert.auctionState == 0 %}
                                        <div class="alert alert-danger" role="alert">
                                            Vous ne pouvez pas enchérir sur votre propre demande.
                                        </div>
                                    {% else %}
                                        <div class="alert alert-danger" role="alert">
                                            Vous avez déja accepté une enchère, cette demande n'est pas en ligne.
                                        </div>
                                    {% endif %}
                                </div> 
                            </div>
                            {% endif %}
                        {% else %}
                            <div class="row" >
                                <div class="col-md-12" data-toggle="tooltip" 
                                        data-placement="left" title="Connectez-vous">
                                    <a 
                                       class="btn se-btn-action disabled" >
                                        Proposez un prix
                                    </a>
                                    <a 
                                       class="btn btn-default disabled">
                                        Envoyez un message
                                    </a>
                                </div> 
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>          
            <div class="row">
                <div id="content" class="col-md-12">
                    <div class="col-md-6">
                        <h4 class="cat-title">Description</h4>
                        <p>{{ advert.detail |nl2br }}</p>
                        
                    </div>
                <!--
                    <div class="col-md-6">
                        <h4 class="cat-title">Localisation</h4>
                        <div id="gmap-div" class="google-carte"></div>
                    </div>
                -->
                </div>
            </div>     
        </div>
    </div>

    <div class="modal fade"
         id="modalAuctionShow"
         tabindex="-1"
         role="dialog"
         aria-labelledby="modalAuctionShowLabel">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Historique des offres</h4>
              </div>
              <div class="modal-body">
                  {{ include('@SEAuction/Advert/listAuction.html.twig') }}
              </div>
            </div>
          </div>
    </div>
              
    {% endblock %}
    
